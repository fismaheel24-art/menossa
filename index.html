<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رحـلـةالألف ميل </title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            padding: 30px;
            width: 100%;
            max-width: 1200px;
            margin: 20px auto;
        }
        
        h1 {
            text-align: center;
            color: #4285f4;
            margin-bottom: 25px;
            font-size: 28px;
            position: relative;
            padding-bottom: 15px;
        }
        
        h1:after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 50%;
            transform: translateX(50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(to right, #4285f4, #34a853);
            border-radius: 2px;
        }
        
        .instructions {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-right: 5px solid #4285f4;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .instructions h3 {
            color: #4285f4;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .instructions h3 i {
            margin-left: 10px;
        }
        
        .instructions ol {
            padding-right: 20px;
        }
        
        .instructions li {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #5f6368;
            font-size: 16px;
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        input[type="text"]:focus, textarea:focus {
            border-color: #4285f4;
            outline: none;
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }
        
        button {
            background: linear-gradient(to right, #4285f4, #34a853);
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(66, 133, 244, 0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(66, 133, 244, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 25px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .result h3 {
            margin-bottom: 15px;
            color: #34a853;
            display: flex;
            align-items: center;
        }
        
        .result-box {
            background-color: #f8f9fa;
            padding: 18px;
            border-radius: 8px;
            border: 2px dashed #ccc;
            margin-bottom: 20px;
            word-break: break-all;
            font-family: monospace;
            font-size: 15px;
            line-height: 1.5;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .preview-container {
            margin-top: 25px;
            text-align: center;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .preview-container h3 {
            margin-bottom: 15px;
            color: #ea4335;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preview-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            overflow: auto;
            max-width: 100%;
        }
        
        #image-preview {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            border: 1px solid #ddd;
        }
        
        .image-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: inline-block;
        }
        
        .copy-btn {
            background: linear-gradient(to right, #34a853, #0f9d58);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .copy-btn:hover {
            background: linear-gradient(to right, #2e8b47, #0c8040);
        }
        
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .note {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 25px;
            border-right: 5px solid #ffc107;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .note h3 {
            color: #ffa000;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .icon {
            margin-left: 10px;
            font-size: 20px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* تخصيص شريط التمرير */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* تصميم متجاوب */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            button {
                width: 100%;
            }
        }
        
        /* أنماط جديدة للروابط المتعددة */
        .batch-input {
            margin-bottom: 20px;
        }
        
        .results-container {
            margin-top: 30px;
            display: none;
        }
        
        .result-item {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        .result-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .link-container {
            flex: 1;
            min-width: 300px;
        }
        
        .preview-item {
            flex: 0 0 auto;
            max-width: 200px;
        }
        
        .preview-thumb {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .item-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        
        .item-btn {
            padding: 8px 15px;
            font-size: 14px;
        }
        
        .copy-all-btn {
            background: linear-gradient(to right, #ea4335, #d93025);
            margin-bottom: 20px;
        }
        
        .copy-all-btn:hover {
            background: linear-gradient(to right, #d33426, #c5221f);
        }
        
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #f1f1f1;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, #4285f4, #34a853);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>      رحلة الألف ميل  </h1>
        
 
        
        <div class="input-group batch-input">
            <textarea id="drive-links" placeholder="https://drive.google.com/file/d/1Xyz...
https://drive.google.com/file/d/2Abc...
https://drive.google.com/file/d/3Def..."></textarea>
        </div>
        
        <div class="btn-container">
            <button id="extract-btn">استخراج الروابط</button>
            <button id="clear-btn">مسح الكل</button>
        </div>
        
        <div class="progress-container" id="progress-container">
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
            <div class="progress-text" id="progress-text">0%</div>
        </div>
        
        <div id="alert-box"></div>
        
        <div class="results-container" id="results-container">
            <div class="btn-container">
                <button class="copy-all-btn" id="copy-all-btn">نسخ جميع الروابط</button>
            </div>
            
            <div id="results-list"></div>
        </div>
        
       
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const driveLinksInput = document.getElementById('drive-links');
            const extractBtn = document.getElementById('extract-btn');
            const clearBtn = document.getElementById('clear-btn');
            const alertBox = document.getElementById('alert-box');
            const resultsContainer = document.getElementById('results-container');
            const resultsList = document.getElementById('results-list');
            const copyAllBtn = document.getElementById('copy-all-btn');
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            
            // دالة لعرض التنبيهات
            function showAlert(message, type) {
                alertBox.innerHTML = `<div class="alert ${type}">${message}</div>`;
                alertBox.style.display = 'block';
                
                // إخفاء التنبيه بعد 5 ثوان
                setTimeout(() => {
                    alertBox.style.display = 'none';
                }, 5000);
            }
            
            // دالة لاستخراج الرابط المباشر بالصيغة المطلوبة (الحجم الأصلي)
            function extractDirectLink(shareableLink) {
                // نمط regex للتعرف على رابط جوجل درايف
                const regex = /https:\/\/drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)/;
                const match = shareableLink.match(regex);
                
                if (match && match[1]) {
                    const fileId = match[1];
                    // إرجاع الرابط بالصيغة المطلوبة بدون تحديد أبعاد
                    return `https://lh3.google.com/u/0/d/${fileId}`;
                }
                
                return null;
            }
            
            // دالة للحصول على حجم الملف
            function getFileSize(url, callback) {
                const xhr = new XMLHttpRequest();
                xhr.open("HEAD", url, true);
                xhr.onreadystatechange = function() {
                    if (this.readyState === this.DONE) {
                        const size = xhr.getResponseHeader("content-length");
                        callback(size ? Math.round(size / 1024) : 'غير معروف');
                    }
                };
                xhr.send();
            }
            
            // دالة لإنشاء عنصر نتيجة
            function createResultItem(originalLink, directLinkUrl, index) {
                const item = document.createElement('div');
                item.className = 'result-item';
                item.id = `result-${index}`;
                
                item.innerHTML = `
                    <div class="result-content">
                        <div class="link-container">
                            <h4>الرابط الأصلي:</h4>
                            <div class="result-box">${originalLink}</div>
                            <h4>الرابط المباشر (الحجم الأصلي):</h4>
                            <div class="result-box direct-link">${directLinkUrl}</div>
                            <div class="item-actions">
                                <button class="item-btn copy-btn" data-link="${directLinkUrl}">نسخ الرابط</button>
                                <button class="item-btn view-btn" data-link="${directLinkUrl}">معاينة الصورة</button>
                            </div>
                        </div>
                        <div class="preview-item">
                            <h4>معاينة مصغرة:</h4>
                            <img class="preview-thumb" src="${directLinkUrl}" alt="معاينة الصورة" onerror="this.style.display='none'" />
                            <div class="image-info">
                                الأبعاد: <span class="image-dimensions">جاري التحميل...</span><br>
                                الحجم: <span class="image-size">جاري التحميل...</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // إضافة معالج الأحداث لأزرار النسخ والمعاينة
                const copyBtn = item.querySelector('.copy-btn');
                copyBtn.addEventListener('click', function() {
                    const link = this.getAttribute('data-link');
                    copyToClipboard(link);
                    showAlert('تم نسخ الرابط إلى الحافظة!', 'success');
                    
                    // تأثير مرئي عند النسخ
                    this.textContent = 'تم النسخ!';
                    setTimeout(() => {
                        this.textContent = 'نسخ الرابط';
                    }, 2000);
                });
                
                const viewBtn = item.querySelector('.view-btn');
                viewBtn.addEventListener('click', function() {
                    const link = this.getAttribute('data-link');
                    window.open(link, '_blank');
                });
                
                // تحميل معلومات الصورة
                const img = item.querySelector('.preview-thumb');
                const dimensions = item.querySelector('.image-dimensions');
                const size = item.querySelector('.image-size');
                
                if (img.complete && img.naturalWidth !== 0) {
                    updateImageInfo(img, dimensions, size, directLinkUrl);
                } else {
                    img.onload = function() {
                        updateImageInfo(img, dimensions, size, directLinkUrl);
                    };
                    
                    img.onerror = function() {
                        dimensions.textContent = 'غير متاح';
                        size.textContent = 'غير متاح';
                    };
                }
                
                return item;
            }
            
            // دالة لتحديث معلومات الصورة
            function updateImageInfo(img, dimensionsEl, sizeEl, url) {
                const width = img.naturalWidth;
                const height = img.naturalHeight;
                dimensionsEl.textContent = `${width} x ${height}`;
                
                getFileSize(url, function(size) {
                    sizeEl.textContent = `${size} كيلوبايت`;
                });
            }
            
            // دالة لنسخ النص إلى الحافظة
            function copyToClipboard(text) {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = text;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                document.execCommand('copy');
                document.body.removeChild(tempTextArea);
            }
            
            // حدث النقر على زر الاستخراج
            extractBtn.addEventListener('click', function() {
                const linksText = driveLinksInput.value.trim();
                
                if (!linksText) {
                    showAlert('يرجى إدخال روابط المشاركة من جوجل درايف', 'error');
                    return;
                }
                
                // تقسيم النص إلى مصفوفة من الروابط
                const links = linksText.split('\n').filter(link => link.trim() !== '');
                
                if (links.length === 0) {
                    showAlert('لم يتم العثور على أي روابط صالحة', 'error');
                    return;
                }
                
                // إعداد شريط التقدم
                progressContainer.style.display = 'block';
                progressBar.style.width = '0%';
                progressText.textContent = '0%';
                
                // مسح النتائج السابقة
                resultsList.innerHTML = '';
                resultsContainer.style.display = 'block';
                
                let processed = 0;
                let validLinks = 0;
                
                // معالجة كل رابط
                links.forEach((link, index) => {
                    const directLinkUrl = extractDirectLink(link.trim());
                    
                    if (directLinkUrl) {
                        validLinks++;
                        const resultItem = createResultItem(link.trim(), directLinkUrl, index);
                        resultsList.appendChild(resultItem);
                    }
                    
                    processed++;
                    
                    // تحديث شريط التقدم
                    const progress = (processed / links.length) * 100;
                    progressBar.style.width = `${progress}%`;
                    progressText.textContent = `${Math.round(progress)}%`;
                    
                    // إذا كانت هذه هي المعالجة الأخيرة
                    if (processed === links.length) {
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                            
                            if (validLinks > 0) {
                                showAlert(`تم استخراج ${validLinks} من أصل ${links.length} رابط بنجاح!`, 'success');
                            } else {
                                showAlert('لم يتم استخراج أي رابط صالح. يرجى التأكد من صحة الروابط.', 'error');
                                resultsContainer.style.display = 'none';
                            }
                        }, 500);
                    }
                });
            });
            
            // حدث النقر على زر مسح الكل
            clearBtn.addEventListener('click', function() {
                driveLinksInput.value = '';
                resultsList.innerHTML = '';
                resultsContainer.style.display = 'none';
                alertBox.style.display = 'none';
                progressContainer.style.display = 'none';
            });
            
            // حدث النقر على زر نسخ جميع الروابط
            copyAllBtn.addEventListener('click', function() {
                const directLinks = Array.from(document.querySelectorAll('.direct-link'))
                    .map(el => el.textContent.trim())
                    .filter(text => text !== '')
                    .join('\n');
                
                if (directLinks) {
                    copyToClipboard(directLinks);
                    showAlert('تم نسخ جميع الروابط إلى الحافظة!', 'success');
                    
                    // تأثير مرئي عند النسخ
                    this.textContent = 'تم النسخ!';
                    setTimeout(() => {
                        this.textContent = 'نسخ جميع الروابط';
                    }, 2000);
                } else {
                    showAlert('لا توجد روابط لنسخها', 'error');
                }
            });
        });
    </script>
</body>
</html>